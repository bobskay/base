---
title: dns服务器
date: 2019-10-16 11:44:35
categories: [ops]
tags: [ops，dns]
typora-copy-images-to: ../images
typora-root-url:  E:/blog
---

通过docker安装dns服务器

顶级域名为wangby.wang

服务器清单

主机：win10.wangby.wang 192.168.1.4

虚拟机：myos.wangby.wang 192.68.2.11

虚拟机里的docker主机： 

​	zoo1.wangby.wang 192.168.2.31

​	zoo1.wangby.wang 192.168.2.32

​	zoo1.wangby.wang 192.168.2.33

<!--more-->

# 安装

named.conf

配置文件入口为：/data/bind/etc/named.conf

它包含了是三个文件

```shell
include "/etc/bind/named.conf.options";
include "/etc/bind/named.conf.local";
include "/etc/bind/named.conf.default-zones";
```

## named.conf.local

在named.conf.local添加自己的域名解析文件

```shell
zone "wangby.wang"  { type master; file "/etc/bind/forward.wangby.wang"; };
```

## forward.wangby.wang

哪个域名对应哪个ip都在这个文件里设置

cp ./db.empty forward.wangby.wang

forward文件最终内容

```shell
;
; BIND data file for local loopback interface
;
$TTL	604800
@	IN	SOA	localhost. root.localhost. (
			6
			604800
			86400
			2419200
			604800 )
;
@	IN	NS	localhost.
@	IN	A	127.0.0.1
@	IN	AAAA	::1
win10    IN      A       192.168.1.4
myos	IN	A	192.168.1.114
zoo1	IN	A	192.168.2.31
zoo2	IN	A	192.168.2.32
zoo3	IN	A	192.168.2.33
```

## docker-compose.yml

-v /home/data/dns:/data：这个目录是所有配置文件的存放路径

dns服务器ip设置为 192.168.2.114

```yaml
version: '3'
services:
  dns:
     privileged: true
     restart: always
     image: sameersbn/bind
     container_name: dns
     volumes:
        - /home/data/dns:/data
     networks:
        mynet:
          ipv4_address: 192.168.2.114
networks:
  mynet:
    external: true

```

## 添加机器

如果要添加新的顶级域名就修改： **named.conf.local**

否则直接修改： **named.conf.local**

更新配置：`docker exec dns rndc reconfig`

```shell
rm -rf /home/data/dns/bind/etc/forward.wangby.wang
rm -rf /home/data/dns/bind/etc/named.conf.local
cp $PWD/forward.wangby.wang /home/data/dns/bind/etc/forward.wangby.wang
cp $PWD/named.conf.local /home/data/dns/bind/etc/named.conf.local
#chmod 777 /home/data/dns/bind/etc/*
docker exec dns rndc reconfig
```

# 使用

## Linux

/etc/resolv.conf添加信息域名服务器 
```shell
# Generated by NetworkManager
nameserver 192.168.2.114
nameserver 8.8.8.8
nameserver 114.114.114.114
```

## Windows

直接修改网络属性

![1571199795819](/blog/images/1571199795819.png)

## docker

添加映射文件

```yaml
volumes:
 - /etc/resolv.conf:/etc/resolv.conf
```

# webmin

webmin是网页配置端，默认端口为10000，模式是开启的，如果要关闭添加环境变量-e WEBMIN_ENABLED=false 

访问地址：<https://192.168.2.114:10000/>

用户名密码为linux账户的用户名，修改密码： docker exec -it dns passwd root

进入后选择BIND DNS Server，在Existing DNS Zones里找到自定义的zoons

![1571199910658](/blog/images/1571199910658.png)

进去后点击Address

![1571200036022](/blog/images/1571200036022.png)

配置新地址

![1571200107797](/blog/images/1571200107797.png)

这通操作其实就是在forward.wangby.wang添加了一行

```shell
abc.wangby.wang.	IN	A	192.168.2.xxx
```

